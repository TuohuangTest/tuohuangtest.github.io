
<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> 	
<html lang="en"> 
<!--<![endif]-->
  <head>
    <meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />	<!-- Force Latest IE rendering engine -->
    <title>Unity 2D Gradient Background Transition</title>

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href="http://feeds2.feedburner.com/tu0huang" rel="alternate" title="Tuo" type="application/atom+xml" /> 
    <link rel="shortcut icon" href="/static/images/favicon.png" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 

    <link rel="stylesheet" href="/static/css/style.css">

    <!--[if IE 7]>
      <script src="/static/css/font-awesome-ie7.css"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">	
     

      <article class='fourteen columns' id="article-content" style="border: 0px solid red">

  <a id="avatar" class="four columns" style="width:100px;height:100px;" href="/"></a>

  <header class="eleven columns" id="article-header" style="margin-top:14px;">
    <h1>Unity 2D Gradient Background Transition</h1>
  </header>

  <div class='eleven columns gray' id="date-header" style="margin-bottom: 10px;">
    <p>
      Jun 21, 2014
    </p>

  </div>

  <div style="clear:both"/>
  <div class="fourteen columns" id="article-content">
    <p>When develop 2D games in Unity, sometime we want to make some transition on day-night cycle(e.g. sky color change)</p>

<p>So I have one design for start state of dawn like following: </p>

<p><img src="https://cloud.githubusercontent.com/assets/491610/3633961/ba10f934-0f08-11e4-9f9c-77c34bdbe32c.png" alt="dawn start sky color" /></p>

<p>(bottom color: fe805e, top: 527fc1)</p>

<p>and the end state of dawn: </p>

<p><img src="https://cloud.githubusercontent.com/assets/491610/3633960/ba1003d0-0f08-11e4-8e5b-2b5d8c4f9393.png" alt="dawn end sky color" /></p>

<p>(bottom color: fa8856, top: 7ae0ec)</p>

<p>The final effect should be like this: </p>

<p><img src="https://cloud.githubusercontent.com/assets/491610/3633977/61552796-0f0a-11e4-80ea-f96b879c48ec.gif" alt="transition" /></p>

<h2 id="graident">Graident</h2>

<p>To achieve the gradient background, we need to apply a new gradient shader. The shader would accept one main texture, and two colors.</p>

<div class="highlight"><pre><code class="csharp"> 
<span class="n">Shader</span> <span class="s">&quot;Custom/Gradient&quot;</span> <span class="p">{</span>
<span class="n">Properties</span> <span class="p">{</span>
<span class="na">	[PerRendererData]</span> <span class="n">_MainTex</span> <span class="p">(</span><span class="s">&quot;Sprite Texture&quot;</span><span class="p">,</span> <span class="m">2D</span><span class="p">)</span> <span class="p">=</span> <span class="s">&quot;white&quot;</span> <span class="p">{}</span>
    <span class="n">_Color</span> <span class="p">(</span><span class="s">&quot;Bottom Color&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
    <span class="n">_Color2</span> <span class="p">(</span><span class="s">&quot;Top Color&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
    <span class="n">_Scale</span> <span class="p">(</span><span class="s">&quot;Scale&quot;</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="p">=</span> <span class="m">1</span>
<span class="p">}</span>
 
<span class="n">SubShader</span> <span class="p">{</span>
    <span class="n">Tags</span> <span class="p">{</span><span class="s">&quot;Queue&quot;</span><span class="p">=</span><span class="s">&quot;Background&quot;</span>  <span class="s">&quot;IgnoreProjector&quot;</span><span class="p">=</span><span class="s">&quot;True&quot;</span><span class="p">}</span>
    <span class="n">LOD</span> <span class="m">100</span>
 
    <span class="n">ZWrite</span> <span class="n">On</span>
 
    <span class="n">Pass</span> <span class="p">{</span>
        <span class="n">CGPROGRAM</span>
        <span class="cp">#pragma vertex vert  </span>
        <span class="cp">#pragma fragment frag</span>
        <span class="err">#</span><span class="n">include</span> <span class="s">&quot;UnityCG.cginc&quot;</span>
 
        <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
        <span class="n">fixed4</span> <span class="n">_Color2</span><span class="p">;</span>
        <span class="k">fixed</span>  <span class="n">_Scale</span><span class="p">;</span>
 
        <span class="k">struct</span> <span class="nc">v2f</span> <span class="p">{</span>
            <span class="n">float4</span> <span class="n">pos</span> <span class="p">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
            <span class="n">fixed4</span> <span class="n">col</span> <span class="p">:</span> <span class="n">COLOR</span><span class="p">;</span>
        <span class="p">};</span>
 
        <span class="n">v2f</span> <span class="nf">vert</span> <span class="p">(</span><span class="n">appdata_full</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
            <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="p">=</span> <span class="n">mul</span> <span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
            <span class="n">o</span><span class="p">.</span><span class="n">col</span> <span class="p">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">_Color</span><span class="p">,</span><span class="n">_Color2</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">texcoord</span><span class="p">.</span><span class="n">y</span> <span class="p">);</span>
<span class="c1">//            o.col = half4( v.vertex.y, 0, 0, 1);</span>
            <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
        <span class="p">}</span>
       
 
        <span class="n">float4</span> <span class="nf">frag</span> <span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="p">:</span> <span class="n">COLOR</span> <span class="p">{</span>
            <span class="n">float4</span> <span class="n">c</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="n">c</span><span class="p">.</span><span class="n">a</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
        <span class="p">}</span>
            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Then create a material with that shader and assign the mat to sprite render, finally in script:</p>

<div class="highlight"><pre><code class="csharp"> 
<span class="n">sRender</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">SetColor</span><span class="p">(</span><span class="s">&quot;_Color&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">black</span><span class="p">);</span> <span class="c1">// the bottom color</span>
<span class="n">sRender</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">SetColor</span><span class="p">(</span><span class="s">&quot;_Color2&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">);</span> <span class="c1">// the top color</span>
</code></pre></div>

<h2 id="transition">Transition</h2>

<div class="highlight"><pre><code class="csharp"> 

<span class="k">private</span> <span class="kt">float</span> <span class="n">duration</span> <span class="p">=</span> <span class="m">1.0f</span><span class="p">;</span>
	<span class="k">public</span> <span class="n">SpriteRenderer</span> <span class="n">sRender</span><span class="p">;</span>
	<span class="c1">// Update is called once per frame</span>
	<span class="n">Color</span> <span class="nf">HexToColor</span><span class="p">(</span><span class="kt">string</span> <span class="n">hex</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">byte</span> <span class="n">r</span> <span class="p">=</span> <span class="kt">byte</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">NumberStyles</span><span class="p">.</span><span class="n">HexNumber</span><span class="p">);</span>
		<span class="kt">byte</span> <span class="n">g</span> <span class="p">=</span> <span class="kt">byte</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">NumberStyles</span><span class="p">.</span><span class="n">HexNumber</span><span class="p">);</span>
		<span class="kt">byte</span> <span class="n">b</span> <span class="p">=</span> <span class="kt">byte</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">NumberStyles</span><span class="p">.</span><span class="n">HexNumber</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Color32</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="m">255</span><span class="p">);</span>
	<span class="p">}</span>


	<span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kt">float</span> <span class="n">lerp</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">PingPong</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="n">time</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span> <span class="p">/</span> <span class="n">duration</span><span class="p">;</span>
		<span class="n">sRender</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">SetColor</span><span class="p">(</span><span class="s">&quot;_Color&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">Lerp</span><span class="p">(</span><span class="n">HexToColor</span><span class="p">(</span><span class="s">&quot;fe805e&quot;</span><span class="p">),</span><span class="n">HexToColor</span><span class="p">(</span><span class="s">&quot;fa8856&quot;</span><span class="p">),</span>  <span class="n">lerp</span><span class="p">));</span> <span class="c1">//bottom</span>
		<span class="n">sRender</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">SetColor</span><span class="p">(</span><span class="s">&quot;_Color2&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">Lerp</span><span class="p">(</span><span class="n">HexToColor</span><span class="p">(</span><span class="s">&quot;527fc1&quot;</span><span class="p">),</span><span class="n">HexToColor</span><span class="p">(</span><span class="s">&quot;7ae0ec&quot;</span><span class="p">),</span>  <span class="n">lerp</span><span class="p">));</span> <span class="c1">//top</span>
	<span class="p">}</span>
</code></pre></div>


  </div>
  <hr style="visibility:hidden;"/>
  
  <!--<footer class="ten columns">
    <p id='follow'>
       Follow me on <a href="http://twitter.com/tu0huang">Twitter</a> &
       <a href="http://weibo.com/tu0huang">Weibo</a>	   
    </p>
  </footer> -->
</article>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style fourteen columns" style="margin-bottom: 11px;">
	<a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50f9651243f1723a"></script>
<!-- AddThis Button END -->
<div style="margin-bottom:10px;"/>
<div id="disqus_thread" class="fourteen columns"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tuo'; // required: replace example with your forum shortname  
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html> 
